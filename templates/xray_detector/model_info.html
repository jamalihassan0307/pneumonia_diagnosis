{% extends "base.html" %}
{% load static %}

{% block title %}Model Information - Pneumonia Diagnosis System{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/model_info.css' %}">
{% endblock %}

{% block nav_model %}active{% endblock %}

{% block content %}
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, Helvetica, sans-serif;
            background: #f5f7fa;
        }

        /* Navigation */
        nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0 20px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .nav-title {
            font-size: 16px;
            opacity: 0.9;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.3);
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Main Container */
        .main-container {
            margin-top: 70px;
            padding: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .card h3 {
            color: #333;
            font-size: 16px;
            margin: 30px 0 20px;
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 12px;
        }

        .status-active {
            background: #c8e6c9;
            color: #2e7d32;
        }

        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .info-value {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .metric-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #333;
        }

        .progress-bar {
            background: #f0f0f0;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        /* Table */
        .model-table {
            width: 100%;
            border-collapse: collapse;
        }

        .model-table th {
            background: #f5f7fa;
            color: #333;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #ddd;
        }

        .model-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .model-table tr:hover {
            background: #f9fafb;
        }

        /* Feature List */
        .feature-list {
            list-style: none;
        }

        .feature-list li {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .feature-list li:before {
            content: "‚úì";
            color: #2e7d32;
            font-weight: bold;
            margin-right: 15px;
            font-size: 18px;
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        /* Alert Box */
        .alert-box {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-info {
            background: #e3f2fd;
            border-color: #1976d2;
            color: #1565c0;
        }

        /* Diagram */
        .architecture-diagram {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .diagram-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .diagram {
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 600px;
        }

        .diagram-box {
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px 20px;
            text-align: center;
            font-weight: 600;
            color: #333;
            min-width: 120px;
        }

        .diagram-arrow {
            color: #667eea;
            font-size: 24px;
            font-weight: bold;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-title {
                display: none;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .model-table {
                font-size: 12px;
            }

            .model-table td, .model-table th {
                padding: 10px;
            }

            .diagram {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>

    <!-- Main Content -->
    <div class="main-container">
        <div class="page-header">
            <h1>üß† AI Model Information</h1>
            <p style="color: #999; margin-top: 10px;">Technical details about the pneumonia diagnosis model</p>
        </div>

        <!-- Overview Card -->
        <div class="card">
            <h2>Model Overview</h2>
            <div class="alert-box alert-info">
                <strong>Current Active Model:</strong> This system uses a deep learning neural network specifically trained to detect pneumonia in chest X-ray images with high accuracy.
            </div>

            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Model Name</div>
                    <div class="info-value" id="modelName">MobileNetV2</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Model Version</div>
                    <div class="info-value" id="modelVersion">1.0.0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Model Status</div>
                    <div class="info-value">
                        <span class="status-badge status-active">‚úì Active</span>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">Training Date</div>
                    <div class="info-value" id="trainingDate">2024-01-15</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Framework</div>
                    <div class="info-value">TensorFlow/Keras</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Input Size</div>
                    <div class="info-value">224√ó224 Grayscale</div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics Card -->
        <div class="card">
            <h2>Performance Metrics</h2>
            <p style="color: #999; margin-bottom: 30px;">Model evaluation results on test dataset</p>

            <div class="metrics-grid" id="metricsGrid">
                <div class="metric-card">
                    <div class="metric-number" id="accuracy">95.2%</div>
                    <div class="metric-label">Accuracy</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="precision">93.8%</div>
                    <div class="metric-label">Precision</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="recall">94.5%</div>
                    <div class="metric-label">Recall</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="f1score">94.1%</div>
                    <div class="metric-label">F1-Score</div>
                </div>
            </div>

            <h3>Detailed Metrics</h3>
            <div style="margin-top: 20px;">
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Accuracy</span>
                        <span id="accuracyPercent">95.2%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 95.2%"></div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>Sensitivity (True Positive Rate)</span>
                        <span id="sensitivityPercent">94.5%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 94.5%"></div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>Specificity (True Negative Rate)</span>
                        <span id="specificityPercent">95.8%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 95.8%"></div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>Area Under ROC Curve (AUC)</span>
                        <span id="aucPercent">97.2%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 97.2%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Architecture Card -->
        <div class="card">
            <h2>Model Architecture</h2>
            <p style="color: #999; margin-bottom: 20px;">Deep learning neural network structure</p>

            <div class="architecture-diagram">
                <div class="diagram-title">Processing Pipeline</div>
                <div class="diagram">
                    <div class="diagram-box">Input Image<br><small>224√ó224</small></div>
                    <div class="diagram-arrow">‚Üí</div>
                    <div class="diagram-box">Preprocessing<br><small>Normalization</small></div>
                    <div class="diagram-arrow">‚Üí</div>
                    <div class="diagram-box">MobileNetV2<br><small>Feature Extraction</small></div>
                    <div class="diagram-arrow">‚Üí</div>
                    <div class="diagram-box">Classification<br><small>Normal/Pneumonia</small></div>
                </div>
            </div>

            <h3>Network Layers</h3>
            <table class="model-table">
                <thead>
                    <tr>
                        <th>Layer Name</th>
                        <th>Type</th>
                        <th>Output Shape</th>
                        <th>Parameters</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Input</td>
                        <td>Input Layer</td>
                        <td>(None, 224, 224, 1)</td>
                        <td>0</td>
                    </tr>
                    <tr>
                        <td>MobileNetV2</td>
                        <td>Pre-trained Model</td>
                        <td>(None, 7, 7, 1280)</td>
                        <td>2,257,984</td>
                    </tr>
                    <tr>
                        <td>GlobalAveragePooling2D</td>
                        <td>Pooling</td>
                        <td>(None, 1280)</td>
                        <td>0</td>
                    </tr>
                    <tr>
                        <td>Dense</td>
                        <td>Dense</td>
                        <td>(None, 256)</td>
                        <td>327,936</td>
                    </tr>
                    <tr>
                        <td>Dropout</td>
                        <td>Dropout</td>
                        <td>(None, 256)</td>
                        <td>0</td>
                    </tr>
                    <tr>
                        <td>Output</td>
                        <td>Dense (Softmax)</td>
                        <td>(None, 2)</td>
                        <td>514</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Features Card -->
        <div class="card">
            <h2>Model Features & Capabilities</h2>
            <ul class="feature-list">
                <li>Binary classification: Normal vs. Pneumonia detection</li>
                <li>Transfer learning using pre-trained MobileNetV2</li>
                <li>Fast inference: ~2-5 seconds per image</li>
                <li>Handles grayscale chest X-ray images at 224√ó224 pixels</li>
                <li>Provides confidence scores for each prediction</li>
                <li>Automatic image preprocessing and normalization</li>
                <li>Confidence level classification (High/Moderate/Low)</li>
                <li>Support for multiple image formats (PNG, JPG, JPEG)</li>
            </ul>
        </div>

        <!-- Training Information Card -->
        <div class="card">
            <h2>Training Information</h2>

            <h3>Training Specifications</h3>
            <table class="model-table">
                <tbody>
                    <tr>
                        <td><strong>Training Dataset Size</strong></td>
                        <td>5,856 images (train: 4,000, validation: 1,000, test: 856)</td>
                    </tr>
                    <tr>
                        <td><strong>Training Epochs</strong></td>
                        <td>50</td>
                    </tr>
                    <tr>
                        <td><strong>Batch Size</strong></td>
                        <td>32</td>
                    </tr>
                    <tr>
                        <td><strong>Optimizer</strong></td>
                        <td>Adam (learning rate: 0.001)</td>
                    </tr>
                    <tr>
                        <td><strong>Loss Function</strong></td>
                        <td>Categorical Crossentropy</td>
                    </tr>
                    <tr>
                        <td><strong>Regularization</strong></td>
                        <td>Dropout (0.5), L2 Regularization</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top: 30px;">Image Preprocessing</h3>
            <p style="margin-bottom: 15px; color: #666;">During preprocessing, each chest X-ray image undergoes the following transformations:</p>
            <ul class="feature-list">
                <li>Resize to 224√ó224 pixels to match model input</li>
                <li>Convert to grayscale format (single channel)</li>
                <li>Normalize pixel values to [0, 1] range</li>
                <li>Apply histogram equalization for contrast enhancement</li>
                <li>Remove noise using Gaussian smoothing</li>
            </ul>
        </div>

        <!-- Limitations & Considerations Card -->
        <div class="card">
            <h2>Important Considerations</h2>

            <div class="alert-box alert-info">
                <h3 style="color: #1565c0; margin-bottom: 10px;">‚ö†Ô∏è Clinical Use Disclaimer</h3>
                <p>This AI model is designed as a diagnostic assistance tool and should NOT be used as the sole basis for clinical diagnosis. All predictions must be reviewed and validated by qualified radiologists or medical professionals. This system is intended to augment, not replace, professional medical judgment.</p>
            </div>

            <h3>Limitations</h3>
            <ul class="feature-list">
                <li>Trained exclusively on adult chest X-rays; pediatric images may show reduced accuracy</li>
                <li>Performance may vary with different X-ray equipment and imaging protocols</li>
                <li>Cannot detect all causes of pneumonia or diagnose other respiratory conditions</li>
                <li>Dependent on image quality; low-quality scans may produce unreliable results</li>
                <li>Does not perform multi-class classification (only Normal vs. Pneumonia)</li>
            </ul>

            <h3 style="margin-top: 20px;">Best Practices</h3>
            <ul class="feature-list">
                <li>Always correlate AI results with clinical presentation and symptoms</li>
                <li>Use as a secondary confirmation, not primary diagnosis tool</li>
                <li>Ensure proper image quality before analysis</li>
                <li>Document AI analysis as part of medical record</li>
                <li>Maintain regular model updates and retraining with new data</li>
                <li>Monitor model performance continuously in production</li>
            </ul>
        </div>

        <!-- Support Card -->
        <div class="card">
            <h2>Support & Updates</h2>
            <p style="margin-bottom: 20px; color: #666;">For questions or issues regarding the model, please contact the development team.</p>

            <table class="model-table">
                <tbody>
                    <tr>
                        <td><strong>Last Updated</strong></td>
                        <td id="lastUpdated">2024-02-18</td>
                    </tr>
                    <tr>
                        <td><strong>Next Scheduled Review</strong></td>
                        <td>2024-06-18 (Quarterly)</td>
                    </tr>
                    <tr>
                        <td><strong>Last Performance Audit</strong></td>
                        <td>2024-02-15</td>
                    </tr>
                    <tr>
                        <td><strong>Model License</strong></td>
                        <td>Internal Use Only</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Load model information
        loadModelInfo();

        async function loadModelInfo() {
            try {
                const response = await fetch('/api/model-versions/', {
                    credentials: 'same-origin'
                });

                const data = await response.json();
                if (data.results && data.results.length > 0) {
                    const activeModel = data.results.find(m => m.is_active) || data.results[0];
                    displayModelInfo(activeModel);
                }
            } catch (error) {
                console.error('Error loading model info:', error);
            }
        }

        function displayModelInfo(model) {
            document.getElementById('modelName').textContent = model.model_name || 'MobileNetV2';
            document.getElementById('modelVersion').textContent = model.version || '1.0.0';
            document.getElementById('trainingDate').textContent = new Date(model.created_at).toLocaleDateString();

            if (model.accuracy) {
                const acc = (model.accuracy * 100).toFixed(1);
                document.getElementById('accuracy').textContent = acc + '%';
            }
            if (model.precision) {
                const prec = (model.precision * 100).toFixed(1);
                document.getElementById('precision').textContent = prec + '%';
            }
            if (model.recall) {
                const rec = (model.recall * 100).toFixed(1);
                document.getElementById('recall').textContent = rec + '%';
            }
            if (model.f1_score) {
                const f1 = (model.f1_score * 100).toFixed(1);
                document.getElementById('f1score').textContent = f1 + '%';
            }

            document.getElementById('lastUpdated').textContent = new Date(model.updated_at).toLocaleDateString();
        }

    </script>
{% endblock %}
