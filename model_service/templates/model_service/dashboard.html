{% extends 'model_service/base.html' %}

{% block title %}Dashboard - Pneumonia Diagnosis System{% endblock %}

{% block content %}
<div class="card">
    <h1>üìä Dashboard</h1>
    <p>Welcome, {{ user.get_full_name|default:user.username }}!</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">Total Predictions</div>
        <div class="stat-value">{{ total_predictions }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Pneumonia Cases</div>
        <div class="stat-value" style="color: #ff6b6b;">{{ pneumonia_count }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Normal Cases</div>
        <div class="stat-value" style="color: #51cf66;">{{ normal_count }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Avg. Confidence</div>
        <div class="stat-value">{{ avg_confidence|floatformat:2 }}%</div>
    </div>
</div>

<div class="card">
    <h2>üöÄ Quick Actions</h2>
    <a href="{% url 'model_service:upload' %}" class="btn btn-primary">‚ûï Upload X-ray Image</a>
    <a href="{% url 'model_service:history' %}" class="btn btn-secondary">üìú View History</a>
</div>

{% if recent_predictions %}
<div class="card">
    <h2>üìã Recent Predictions</h2>
    <table>
        <thead>
            <tr>
                <th>Image</th>
                <th>Prediction</th>
                <th>Confidence</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for pred in recent_predictions %}
            <tr>
                <td>{{ pred.image.original_filename|truncatechars:30 }}</td>
                <td>
                    {% if pred.prediction_label == 'PNEUMONIA' %}
                        <span class="badge badge-danger">üö® PNEUMONIA</span>
                    {% else %}
                        <span class="badge badge-success">‚úì NORMAL</span>
                    {% endif %}
                </td>
                <td>
                    <span class="confidence-{% if pred.confidence_level == 'HIGH' %}high{% elif pred.confidence_level == 'MODERATE' %}moderate{% else %}low{% endif %}">
                        {{ pred.get_confidence_percentage|floatformat:2 }}%
                    </span>
                </td>
                <td>{{ pred.created_at|date:"M d, Y H:i" }}</td>
                <td>
                    <a href="{% url 'model_service:result' pred.id %}" class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.9em;">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="card">
    <h2>üìã No Predictions Yet</h2>
    <p>You haven't made any predictions yet. <a href="{% url 'model_service:upload' %}">Upload an X-ray image to get started!</a></p>
</div>
{% endif %}

<div class="card">
    <h2>‚ö†Ô∏è Important Disclaimer</h2>
    <p>
        This Pneumonia Diagnosis System is an AI-powered preliminary screening tool designed to <strong>assist</strong> medical professionals 
        in analyzing chest X-ray images. It is <strong>NOT</strong> a replacement for professional radiological diagnosis or clinical judgment.
    </p>
    <ul style="margin-left: 20px;">
        <li>Results should be reviewed and confirmed by qualified radiologists</li>
        <li>Do not rely solely on this system for medical decisions</li>
        <li>Follow your institution's established diagnostic protocols</li>
        <li>Report false positives/negatives to improve the system</li>
    </ul>
</div>
{% endblock %}
